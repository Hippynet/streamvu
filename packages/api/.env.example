# =============================================================================
# StreamVU API Configuration
# =============================================================================
# Copy this file to .env and fill in the values for your environment.
# Required variables are marked with [REQUIRED]
# =============================================================================

# -----------------------------------------------------------------------------
# Environment
# -----------------------------------------------------------------------------
NODE_ENV=development
# NODE_ENV=production

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
# Port the API server listens on
API_PORT=3002

# Host to bind to (0.0.0.0 for all interfaces, 127.0.0.1 for localhost only)
API_HOST=0.0.0.0

# [REQUIRED in production] Public URL of the API (for generating callbacks, links)
# PUBLIC_URL=https://api.streamvu.example.com

# [REQUIRED in production] URL of the frontend application
# FRONTEND_URL=https://streamvu.example.com

# -----------------------------------------------------------------------------
# Database [REQUIRED]
# -----------------------------------------------------------------------------
# PostgreSQL connection string
DATABASE_URL="postgresql://streamvu:devpassword@localhost:5433/streamvu"

# Production example with SSL:
# DATABASE_URL="postgresql://user:password@db.example.com:5432/streamvu?sslmode=require"

# -----------------------------------------------------------------------------
# Authentication [REQUIRED in production]
# -----------------------------------------------------------------------------
# JWT secret key - MUST be a secure random string in production
# Generate with: openssl rand -base64 64
JWT_SECRET="dev-secret-change-in-production"

# Token expiry times
JWT_ACCESS_EXPIRY="15m"
JWT_REFRESH_EXPIRY="7d"

# -----------------------------------------------------------------------------
# CORS Configuration
# -----------------------------------------------------------------------------
# Allowed origins for CORS requests
# Single origin:
CORS_ORIGIN="http://localhost:3003"

# Multiple origins (comma-separated):
# CORS_ORIGIN="https://app.example.com,https://admin.example.com"

# Allow all origins (NOT recommended for production):
# CORS_ORIGIN="*"

# -----------------------------------------------------------------------------
# Google OAuth (Optional)
# -----------------------------------------------------------------------------
# Get credentials from: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID="your-client-id.apps.googleusercontent.com"
# GOOGLE_CLIENT_SECRET="your-client-secret"
# GOOGLE_CALLBACK_URL="https://api.streamvu.example.com/api/auth/google/callback"

# -----------------------------------------------------------------------------
# mediasoup WebRTC Configuration
# -----------------------------------------------------------------------------
# Public IP address for WebRTC (required for production)
# This should be the public IP that clients can reach
# MEDIASOUP_ANNOUNCED_IP=203.0.113.1

# Port range for WebRTC media
MEDIASOUP_MIN_PORT=40000
MEDIASOUP_MAX_PORT=49999

# TURN server configuration (recommended for production)
# TURN_HOST=turn.example.com
# TURN_PORT=3478
# TURN_USERNAME=turnuser
# TURN_PASSWORD=turnpassword

# -----------------------------------------------------------------------------
# WHMCS Integration (Optional)
# -----------------------------------------------------------------------------
# Secret key for WHMCS webhook authentication
# WHMCS_SECRET="your-whmcs-webhook-secret"

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
# Time window in milliseconds (default: 60000 = 1 minute)
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests per window (default: 100)
RATE_LIMIT_MAX_REQUESTS=100

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Log level: debug, info, warn, error
LOG_LEVEL=debug

# Log format: pretty (for development), json (for production)
LOG_FORMAT=pretty

# -----------------------------------------------------------------------------
# Trusted Proxies
# -----------------------------------------------------------------------------
# Comma-separated list of trusted proxy IPs (for correct client IP detection)
# Required when running behind a reverse proxy (nginx, cloudflare, etc.)
# TRUSTED_PROXIES="127.0.0.1,10.0.0.0/8"

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
# Disable specific features (enabled by default)
# FEATURE_CALL_CENTER=false
# FEATURE_RECORDINGS=false

# -----------------------------------------------------------------------------
# Return Video Feed
# -----------------------------------------------------------------------------
# Default URL for program return feed (contributors see program output)
# RETURN_FEED_DEFAULT_URL=https://example.com/hls/program.m3u8

# -----------------------------------------------------------------------------
# WHIP/WHEP Configuration
# -----------------------------------------------------------------------------
# Enable WHIP ingest from OBS 30+, vMix, etc.
WHIP_ENABLED=true

# ICE servers for WHIP WebRTC connections (comma-separated)
# WHIP_ICE_SERVERS=stun:stun.l.google.com:19302,stun:stun1.l.google.com:19302

# WHIP endpoint authentication (leave empty to require per-stream tokens)
# WHIP_DEFAULT_TOKEN=

# -----------------------------------------------------------------------------
# SRT Configuration
# -----------------------------------------------------------------------------
# Port range for SRT listener mode
SRT_PORT_MIN=30000
SRT_PORT_MAX=30999

# Default SRT latency in milliseconds
SRT_DEFAULT_LATENCY=120

# Maximum simultaneous SRT connections
SRT_MAX_CONNECTIONS=50

# -----------------------------------------------------------------------------
# RIST Configuration
# -----------------------------------------------------------------------------
# Port range for RIST listener mode
RIST_PORT_MIN=31000
RIST_PORT_MAX=31999

# Default RIST buffer size in milliseconds
RIST_DEFAULT_BUFFER=1000

# RIST profile: simple or main
RIST_DEFAULT_PROFILE=simple

# -----------------------------------------------------------------------------
# Cloud Storage - Amazon S3
# -----------------------------------------------------------------------------
# AWS_S3_BUCKET=streamvu-recordings
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
# AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# For S3-compatible services (MinIO, Backblaze B2, DigitalOcean Spaces):
# AWS_S3_ENDPOINT=https://s3.example.com
# AWS_S3_PATH_STYLE=true

# -----------------------------------------------------------------------------
# Cloud Storage - Google Cloud Storage
# -----------------------------------------------------------------------------
# GCS_BUCKET=streamvu-recordings
# GCS_PROJECT_ID=your-project-id
# GCS_KEY_FILE=/path/to/service-account-key.json
# Or use inline JSON:
# GCS_CREDENTIALS={"type":"service_account",...}

# -----------------------------------------------------------------------------
# Cloud Storage - Azure Blob Storage
# -----------------------------------------------------------------------------
# AZURE_CONTAINER_NAME=recordings
# AZURE_STORAGE_ACCOUNT=mystorageaccount
# AZURE_STORAGE_KEY=your-storage-key
# Or use connection string:
# AZURE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=...

# -----------------------------------------------------------------------------
# Cloud Storage - Frame.io
# -----------------------------------------------------------------------------
# FRAMEIO_TEAM_ID=team-xxx
# FRAMEIO_PROJECT_ID=project-xxx
# FRAMEIO_ACCESS_TOKEN=fio-u-xxx

# -----------------------------------------------------------------------------
# Transcription - OpenAI Whisper
# -----------------------------------------------------------------------------
# WHISPER_API_URL=https://api.openai.com/v1/audio/transcriptions
# WHISPER_API_KEY=sk-xxx
# WHISPER_MODEL=whisper-1

# -----------------------------------------------------------------------------
# Transcription - AssemblyAI
# -----------------------------------------------------------------------------
# ASSEMBLYAI_API_KEY=xxx
# ASSEMBLYAI_SPEECH_MODEL=best

# -----------------------------------------------------------------------------
# Transcription - Deepgram
# -----------------------------------------------------------------------------
# DEEPGRAM_API_KEY=xxx
# DEEPGRAM_MODEL=nova-2

# -----------------------------------------------------------------------------
# Transcription - AWS Transcribe
# -----------------------------------------------------------------------------
# AWS_TRANSCRIBE_REGION=us-east-1
# (Uses AWS credentials from Cloud Storage section)

# -----------------------------------------------------------------------------
# Transcription - Google Speech-to-Text
# -----------------------------------------------------------------------------
# GOOGLE_SPEECH_PROJECT_ID=your-project-id
# (Uses GCS credentials from Cloud Storage section)

# -----------------------------------------------------------------------------
# NDI Bridge
# -----------------------------------------------------------------------------
# Enable NDI bridge for hardware integration
NDI_BRIDGE_ENABLED=false

# Port for NDI bridge communication
NDI_BRIDGE_PORT=5960

# NDI discovery groups (comma-separated)
# NDI_GROUPS=production,backup

# Network interfaces for NDI (comma-separated IPs, empty for all)
# NDI_SEND_NETMASK=192.168.1.0/24
# NDI_RECEIVE_NETMASK=192.168.1.0/24

# -----------------------------------------------------------------------------
# Webhooks
# -----------------------------------------------------------------------------
# Maximum webhook delivery attempts before giving up
WEBHOOK_MAX_RETRIES=5

# Delay between retry attempts in milliseconds (exponential backoff base)
WEBHOOK_RETRY_DELAY=1000

# Webhook request timeout in milliseconds
WEBHOOK_TIMEOUT=10000

# Disable consecutive failure threshold (webhooks disabled after N failures)
WEBHOOK_FAILURE_THRESHOLD=10

# -----------------------------------------------------------------------------
# File Storage
# -----------------------------------------------------------------------------
# Local storage path for recordings and uploads
STORAGE_PATH=./storage

# Maximum file size for uploads (in bytes, default 500MB)
MAX_UPLOAD_SIZE=524288000

# Temporary file directory
TEMP_DIR=./tmp

# -----------------------------------------------------------------------------
# FFmpeg
# -----------------------------------------------------------------------------
# Path to FFmpeg binary (uses system FFmpeg if not set)
# FFMPEG_PATH=/usr/local/bin/ffmpeg

# Number of FFmpeg worker threads (0 = auto)
FFMPEG_THREADS=0

# Hardware acceleration (none, vaapi, nvenc, qsv)
FFMPEG_HWACCEL=none
